# GIL

#### GIL 仅针对 MRI Ruby，只有 MRI 有 GIL。

---

![](/images/program/ruby/gil.png)

#### 1. ruby线程运行会依赖原生的操作系统线程，并且ruby线程在进入操作系统线程中运行前，需要拿到 GIL。

#### 2. 因此即使有多核CPU，也没办法实现并行，在特定时间点上只有一个线程可以获取 GIL 运行。

#### 3. 计时器线程(Timer Thread)
* 用来避免一个线程独霸 GIL。一旦有一个线程在等待 GIL，它即会唤醒计时器线程。每 100 毫秒，计时器线程在当前持有 GIL 的线程上设置一个中断标志。
* 当前持有 GIL 的线程会在当前ruby方法调用结束，返回值前停止执行。并检查中断标志，并释放 GIL，并且等待另一个线程释放 GIL。
* 按我的理解：也就是说，对于一个原生的ruby方法，它是一个整体，里面的逻辑是会全部执行完的。

#### 4. GIL 保证了 MRI 中 C 实现的原生 ruby 方法执行的原子性。但是在我们开发者编写多线程代码时，需要考虑线程安全以及竞争冲突。

::: tip 参考链接

[无人知晓的 GIL](https://ruby-china.org/topics/28415)

:::
